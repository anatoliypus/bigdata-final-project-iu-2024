0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- Query 3: UV Index Distribution
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> USE team29_projectdb;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- Drop the existing results table if it exists
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> DROP TABLE IF EXISTS q3_results;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- Create an external table to store the results
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> CREATE EXTERNAL TABLE q3_results (
. . . . . . . . . . . . . . . . . . . . . . .>     uv_index INT,
. . . . . . . . . . . . . . . . . . . . . . .>     count_uv_index INT
. . . . . . . . . . . . . . . . . . . . . . .> )
. . . . . . . . . . . . . . . . . . . . . . .> ROW FORMAT DELIMITED
. . . . . . . . . . . . . . . . . . . . . . .> FIELDS TERMINATED BY ','
. . . . . . . . . . . . . . . . . . . . . . .> LOCATION 'project/hive/warehouse/q3';
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- Calculate the distribution of UV index
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> INSERT INTO q3_results
. . . . . . . . . . . . . . . . . . . . . . .> SELECT 
. . . . . . . . . . . . . . . . . . . . . . .>     uv_index_1 AS uv_index,
. . . . . . . . . . . . . . . . . . . . . . .>     COUNT(*) AS count_uv_index
. . . . . . . . . . . . . . . . . . . . . . .> FROM dataset_part_buck
. . . . . . . . . . . . . . . . . . . . . . .> GROUP BY uv_index_1
. . . . . . . . . . . . . . . . . . . . . . .> UNION ALL
. . . . . . . . . . . . . . . . . . . . . . .> SELECT 
. . . . . . . . . . . . . . . . . . . . . . .>     uv_index_2 AS uv_index,
. . . . . . . . . . . . . . . . . . . . . . .>     COUNT(*) AS count_uv_index
. . . . . . . . . . . . . . . . . . . . . . .> FROM dataset_part_buck
. . . . . . . . . . . . . . . . . . . . . . .> GROUP BY uv_index_2;
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> -- Display the results
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> SELECT * FROM q3_results;
+-----------+-----------------+
| uv_index  | count_uv_index  |
+-----------+-----------------+
| 7         | 213600          |
| 9         | 57504           |
| 5         | 125208          |
| 8         | 108384          |
| 3         | 1608            |
| 4         | 25536           |
| 6         | 233568          |
| 10        | 5856            |
| 11        | 192             |
| 7         | 122111          |
| 9         | 46124           |
| 5         | 40217           |
| 8         | 89315           |
| 1         | 353638          |
| 2         | 36              |
| 3         | 792             |
| 4         | 7805            |
| 6         | 90595           |
| 10        | 18965           |
| 11        | 1858            |
+-----------+-----------------+
0: jdbc:hive2://hadoop-03.uni.innopolis.ru:10> 